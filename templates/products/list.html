{% extends "base.html" %}
{% load static %}  

{% block content %}
<h1>Our Products</h1>

<!-- Display messages if any -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="product-grid">
  {% for product in products %}
    <div class="product-card">
      <a href="{% url 'products:detail' product.id %}">
        <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'images/default-product.png' %}{% endif %}" 
             alt="{{ product.name }}">
        <h3>{{ product.name }}</h3>
        <p>${{ product.price }}</p>
      </a>
      
      <!-- Single Add to Cart form per product -->
      <form action="{% url 'cart:add' product.id %}" method="post" class="add-to-cart-form">
        {% csrf_token %}
        <div class="quantity-selector">
          <label for="quantity-{{ product.id }}">Qty:</label>
          <input type="number" 
                 id="quantity-{{ product.id }}" 
                 name="quantity" 
                 value="1" 
                 min="1"
                 max="{{ product.stock }}">
        </div>
        <button type="submit" class="add-to-cart-btn">
          Add to Cart
        </button>
      </form>
    </div>
  {% empty %}
    <p>No products available.</p>
  {% endfor %}
</div>
{% endblock %}